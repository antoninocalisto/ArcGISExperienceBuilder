System.register(["jimu-core","jimu-arcgis","esri/layers/FeatureLayer","esri/layers/support/Field","esri/renderers/ClassBreaksRenderer","esri/symbols/SimpleMarkerSymbol"],(function(e,t){var o={},a={},r={},i={},s={},n={};return{setters:[function(e){o.Global=e.Global,o.React=e.React,o.css=e.css,o.jsx=e.jsx},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){r.default=e.default},function(e){i.default=e.default},function(e){s.default=e.default},function(e){n.default=e.default}],execute:function(){e((()=>{var e={633:e=>{"use strict";e.exports=r},110:e=>{"use strict";e.exports=i},841:e=>{"use strict";e.exports=s},417:e=>{"use strict";e.exports=n},686:e=>{"use strict";e.exports=a},244:e=>{"use strict";e.exports=o}},t={};function l(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,l),r.exports}l.d=(e,t)=>{for(var o in t)l.o(t,o)&&!l.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var c={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(c),l.d(c,{__set_webpack_public_path__:()=>I,default:()=>_});var e=l(244),t=l(686),o=l(633),a=l(110),r=l(841),i=l(417),s=function(e,t,o,a){return new(o||(o=Promise))((function(r,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function n(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,n)}l((a=a.apply(e,t||[])).next())}))};const n={lateral:"rgba(88, 19, 252, 0.7)",testemunho:"rgba(255, 0, 255, 0.7)",calha:"rgba(245, 201, 38, 0.7)",plug:"rgba(125, 253, 148, 0.7)","whole core":"rgba(255, 43, 24, 0.7)"};function u(e){return s(this,arguments,void 0,(function*({jimuMapView:e,dados:t,colorFill:s,idCamada:n,idLegenda:l,titleLegenda:c,withInterest:u}){var d;const p=e.view,m=p.map;if(!t||0===t.length){const e=m.findLayerById(n);return void(e&&m.remove(e))}const f=new o.default({url:"https://basegis.petrobras.com.br/arcgis/rest/services/EXPLORA/Feature_Pocos/MapServer/0",outFields:["POCO_CD_POCO"],visible:!1,title:"Po\xe7os (base)"});yield f.load();const v=f.fields.find((e=>"POCO_CD_POCO"===e.name)),g="string"===(null==v?void 0:v.type),h=`POCO_CD_POCO IN ${function(e,t){if(t)return`(${e.map((e=>`'${String(e).replace(/'/g,"''")}'`)).join(",")})`;return`(${e.join(",")})`}(t.map((e=>e.codigoPoco)).filter((e=>null!=e)),!!g)}`,b=yield f.queryFeatures({where:h,outFields:["POCO_CD_POCO"],returnGeometry:!0}),y=new Map;t.forEach((e=>{var t;return y.set(String(e.codigoPoco),Number(null!==(t=e.total)&&void 0!==t?t:0))}));const x=b.features.map(((e,t)=>{var o;const a=String(e.attributes.POCO_CD_POCO),r=null!==(o=y.get(a))&&void 0!==o?o:0;return e.attributes={OBJECTID:t+1,POCO_CD_POCO:a,TOTAL:r},e})),w=t.map((e=>{var t;return Number(null!==(t=e.total)&&void 0!==t?t:0)}));let C=Math.min(...w),O=Math.max(...w);const P=[],j={color:"black",width:1};if(isFinite(C)&&isFinite(O))if(0===C&&0===O){const e=w.length;P.push({minValue:0,maxValue:0,label:`| 0 | (${e} po\xe7o${e>1?"s":""})`,symbol:new i.default({color:"rgba(200,200,200,0.3)",size:6,style:"circle",outline:j})})}else{const e=w.filter((e=>0===e)).length,t=w.filter((e=>e>0));e>0&&P.push({minValue:0,maxValue:0,label:`| 0 | (${e} po\xe7o${e>1?"s":""})`,symbol:new i.default({color:"rgba(200,200,200,0.3)",size:6,style:"circle",outline:j})}),C=1;const o=Math.max(t.length,1),a=Math.max(2,Math.round(1+3.3*Math.log10(o))),r=Math.ceil((O-C+1)/a),n=40;for(let e=0;e<a;e++){const o=C+e*r,l=C+(e+1)*r-1;if(o>O)break;const c=t.filter((e=>e>=o&&e<=l)).length,u=`${o} |---| ${l} (${c} po\xe7o${c>1?"s":""})`,d=6+e*(n/a);P.push({minValue:o,maxValue:l,label:u,symbol:new i.default({color:s,size:d,style:"circle",outline:j})})}}else;const S=new r.default({field:"TOTAL",classBreakInfos:P}),E=[new a.default({name:"OBJECTID",alias:"OBJECTID",type:"oid"}),new a.default({name:"POCO_CD_POCO",alias:"C\xf3digo do Po\xe7o",type:"string"}),new a.default({name:"TOTAL",alias:"Total",type:"double"})],A=new o.default({id:n,title:c,source:x,fields:E,objectIdField:"OBJECTID",geometryType:"point",spatialReference:null!==(d=null==p?void 0:p.spatialReference)&&void 0!==d?d:{wkid:102100},renderer:S,listMode:"hide",popupEnabled:!0,popupTemplate:{title:"{POCO_CD_POCO}",content:"Total: {TOTAL}"},featureReduction:{type:"cluster",clusterRadius:"80px",symbol:{type:"simple-marker",style:"circle",size:28,color:s,outline:{color:"white",width:1.5}},clusterSymbol:{type:"simple-marker",style:"circle",size:28,color:s,outline:{color:"white",width:1.5}},labelsVisible:!0,labelingInfo:[{deconflictionStrategy:"none",labelExpressionInfo:{expression:"Text($feature.cluster_count, '#,###')"},symbol:{type:"text",color:"white",haloColor:"#333",haloSize:1.5,font:{size:10,weight:"bold"}}}]}}),R=m.findLayerById(n);return R&&m.remove(R),m.add(A),A}))}var d=function(e,t,o,a){return new(o||(o=Promise))((function(r,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function n(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,n)}l((a=a.apply(e,t||[])).next())}))};const p=!1,m={lateral:"totalAmostrasLaterais",testemunho:"totalTestemunhos",calha:"totalCalhas",plug:"totalPlugs","whole core":"totalWholeCore"},f=Object.keys(m),v=e=>Math.log10?Math.log10(e):Math.log(e)/Math.LN10;function g(e){return new Promise(((t,o)=>{const a=Math.random().toString(36).slice(2);let r="*";try{document.referrer&&(r=new URL(document.referrer).origin)}catch(e){}const i=e=>{const r=e.data||{};var s;r.reqId===a&&("fetchDistribuicaoAmostras:ok"===r.type?(window.removeEventListener("message",i),t((s=r.payload,(Array.isArray(s)?s:[]).map((e=>{var t,o,a,r,i,s,n,l,c,u,d,p,m,f;return{codigoPoco:Number(null!==(r=null!==(a=null!==(o=null!==(t=e.codigoPoco)&&void 0!==t?t:e.POCO_CD_POCO)&&void 0!==o?o:e.poco)&&void 0!==a?a:e.codigo)&&void 0!==r?r:0),totalAmostrasLaterais:Number(null!==(s=null!==(i=e.totalAmostrasLaterais)&&void 0!==i?i:e.laterais)&&void 0!==s?s:0),totalCalhas:Number(null!==(l=null!==(n=e.totalCalhas)&&void 0!==n?n:e.calhas)&&void 0!==l?l:0),totalPlugs:Number(null!==(u=null!==(c=e.totalPlugs)&&void 0!==c?c:e.plugs)&&void 0!==u?u:0),totalTestemunhos:Number(null!==(p=null!==(d=e.totalTestemunhos)&&void 0!==d?d:e.testemunhos)&&void 0!==p?p:0),totalWholeCore:Number(null!==(f=null!==(m=e.totalWholeCore)&&void 0!==m?m:e.wholeCore)&&void 0!==f?f:0)}})).filter((e=>!!e.codigoPoco))))):"fetchDistribuicaoAmostras:err"===r.type&&(window.removeEventListener("message",i),o(new Error(r.message||"Erro no fetch via parent"))))};window.addEventListener("message",i),window.parent.postMessage({type:"fetchDistribuicaoAmostras",body:e,reqId:a},r)}))}function h(){return d(this,arguments,void 0,(function*(e=!1){const t=function(e){const t=new URLSearchParams;return t.set("hdSys","novaintcons"),t.set("hdUC","Mapa"),t.set("hdAcao","CarregarMapaDistribuicaoAmostrasContador"),t.set("hdSessionFilter","true"),t.set("faixaInteresse",String(!!e)),t.toString()}(e);return g(t)}))}const b=e.css`
  div[role='dialog'][aria-label='mapa-de-distribuicao'] {
    position: absolute !important;
    inset: 50px 12px auto auto !important; /* top:12, right:12 */
    transform: none !important;
    z-index: 9999 !important;
    width: 360px !important;
    height: 550px !important;
    max-height: calc(100% - 24px) !important;
    overflow: auto !important;
  }
`,y=e.css`
  width: ${40}px;
  height: ${40}px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 8px;
`,x=e.css`
  position: relative; width: 100%; height: 100%;
  background: #fff; border: 1px solid #ddd; border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,.1); padding: 16px; overflow: hidden;
`,w=e.css`font-weight:600; margin-bottom:4px; display:block;`,C=e.css`width:100%; padding:6px 8px; margin-bottom:12px;
  border:1px solid #ccc; border-radius:4px;`,O=e.css`overflow-y:auto; margin-bottom:12px;
  padding:8px; background:#fafafa; border:1px solid #eee; border-radius:4px;`,P=e.css`display:flex; align-items:center; margin-bottom:6px; cursor:pointer;`,j=e.css`
  max-height: 300px;
  overflow-y: auto;
  margin-top: 8px;
  padding: 8px;
  padding-bottom: 36px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 4px;
  position: relative;
`,S=e.css`display:flex; align-items:center; margin-bottom:6px;`,E=e.css`font-size:0.9rem;`,A=e.css`
  position: sticky;
  bottom: 0;
  background: #fff;
  border-top: 1px solid #eee;
  padding: 4px 0;
  display: flex;
  align-items: center;
`,R=e.css`
  display: flex;
  align-items: center;
  gap: 6px;
  padding-left: 1em;
  cursor: pointer;
  font-size: 0.9rem;
  `;function _(o){var a;const[r,i]=e.React.useState(),[s,l]=e.React.useState(""),[c,g]=e.React.useState([]),[_,I]=e.React.useState(!1),[M,k]=e.React.useState(!1),[L,T]=e.React.useState(!1),[$,z]=e.React.useState((()=>new Set((Array.isArray(null==o?void 0:o.codigosFaixaInteresse)?o.codigosFaixaInteresse:[]).map((e=>Number(e))).filter((e=>!isNaN(e)))))),[F,D]=e.React.useState(null),[N,B]=e.React.useState(null),[V,W]=e.React.useState(!1),[J,U]=e.React.useState(!1),[q,G]=e.React.useState(""),[Q,X]=e.React.useState(""),H=e.React.useRef(null);e.React.useEffect((()=>{console.log("Widget atualizado em 30/08/2025");const e=e=>{const t=(null==e?void 0:e.data)||{};"fetchDistribuicaoAmostras:ok"===(null==t?void 0:t.type)&&T(!!t.startWithInterest)};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)}),[]),e.React.useEffect((()=>{const e=e=>{const t=null==e?void 0:e.data;if(!t||"faixa-interesse"!==t.type||!Array.isArray(t.codigosPocos))return;const o=t.codigosPocos.map((e=>Number(e))).filter((e=>!isNaN(e)));console.debug("[intervalo] Recebidos",t.codigosPocos.length,"-> v\xe1lidos (n\xfameros):",o.length),z(new Set(o))};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)}),[]),e.React.useEffect((()=>{let e=!1;return function(){d(this,void 0,void 0,(function*(){if("sample"===s){W(!0),G("");try{const t=yield h(p);e||(D(t),g([]),console.debug("[full] Total de po\xe7os:",t.length))}catch(t){e||(G((null==t?void 0:t.message)||"Falha ao buscar dados (base completa)"),D([]))}finally{e||W(!1)}}}))}(),()=>{e=!0}}),[s]),e.React.useEffect((()=>{let e=!1;return function(){d(this,void 0,void 0,(function*(){if("sample"===s&&M&&!($.size>0)&&null===N){U(!0),X("");try{const t=yield h(!0);e||(B(t),console.debug("[faixaAPI] Total de po\xe7os (API):",t.length))}catch(t){e||(X((null==t?void 0:t.message)||"Falha ao buscar dados do intervalo de interesse"),B([]))}finally{e||U(!1)}}}))}(),()=>{e=!0}}),[s,M,$,N]),e.React.useEffect((()=>{var e;if(!r)return;const t=M?$.size>0?(null!=F?F:[]).filter((e=>$.has(Number(e.codigoPoco)))):null!==(e=null!=N?N:F)&&void 0!==e?e:[]:null!=F?F:[];if(!t||0===t.length)return;const{view:o}=r;f.forEach((e=>{const t=o.map.findLayerById("amostras_"+e);t&&o.map.remove(t)})),c.forEach((e=>{const o=t.map((t=>{var o;return{codigoPoco:t.codigoPoco,total:null!==(o=t[m[e]])&&void 0!==o?o:0}})),a=o.filter((e=>{var t;return(null!==(t=e.total)&&void 0!==t?t:0)>0})).length;console.debug(`[draw] tipo=${e} com valor>0:`,a,"de",o.length);const i=n[e]||"rgba(0,0,0,0.5)";u({jimuMapView:r,dados:o,colorFill:i,idCamada:"amostras_"+e,idLegenda:"lgd_amostras_"+e,titleLegenda:(M?"Intervalo de Interesse - ":"")+(e.charAt(0).toUpperCase()+e.slice(1)),withInterest:M})}))}),[r,c,M,$,F,N]),e.React.useEffect((()=>{const e=null==r?void 0:r.view;if(!e)return;const t=H.current;if(!t)return;const o=function(e){let t=e;for(;t;){if(t.getAttribute&&"dialog"===t.getAttribute("role"))return t;t=t.parentElement}return null}(t);if(!o)return;const a=o.querySelector('button[aria-label="Close"], button[title="Close"], button[aria-label="Fechar"], button[title="Fechar"], [data-action="close"]');if(!a)return;const i=()=>{var t,o,a,r,i,s;try{f.forEach((t=>{const o=e.map.findLayerById("amostras_"+t);o&&e.map.remove(o)}));(null!==(s=null!==(a=null===(o=null===(t=e.map.allLayers)||void 0===t?void 0:t.toArray)||void 0===o?void 0:o.call(t))&&void 0!==a?a:null===(i=null===(r=e.map.layers)||void 0===r?void 0:r.toArray)||void 0===i?void 0:i.call(r))&&void 0!==s?s:[]).forEach((t=>{var o;String(null!==(o=null==t?void 0:t.id)&&void 0!==o?o:"").startsWith("amostras_")&&e.map.remove(t)}))}catch(e){}};return a.addEventListener("click",i),()=>{a.removeEventListener("click",i)}}),[r]),e.React.useEffect((()=>()=>{var e,t,o,a,i,s;const n=null==r?void 0:r.view;if(n)try{f.forEach((e=>{const t=n.map.findLayerById("amostras_"+e);t&&n.map.remove(t)}));(null!==(s=null!==(o=null===(t=null===(e=n.map.allLayers)||void 0===e?void 0:e.toArray)||void 0===t?void 0:t.call(e))&&void 0!==o?o:null===(i=null===(a=n.map.layers)||void 0===a?void 0:a.toArray)||void 0===i?void 0:i.call(a))&&void 0!==s?s:[]).forEach((e=>{var t;String(null!==(t=null==e?void 0:e.id)&&void 0!==t?t:"").startsWith("amostras_")&&n.map.remove(e)}))}catch(e){}}),[r]);const K=e.React.useMemo((()=>{var e;const t=M?$.size>0?(null!=F?F:[]).filter((e=>$.has(Number(e.codigoPoco)))):null!==(e=null!=N?N:F)&&void 0!==e?e:[]:null!=F?F:[];return c.map((e=>{const o=n[e],a=t.map((t=>{var o;return{codigoPoco:t.codigoPoco,total:null!==(o=t[m[e]])&&void 0!==o?o:0}}));let r=function(e,t){const o=e.map((e=>e.total));let a=Math.min(...o),r=Math.max(...o);const i=[];if(!isFinite(a)||!isFinite(r))return i;if(0===a&&0===r)i.push({label:"N\xe3o h\xe1 dados suficientes",size:0,cor:t,count:0});else{const e=o.filter((e=>0===e)).length,s=o.filter((e=>e>0));e>0&&i.push({label:`| 0 | (${e} po\xe7o${e>1?"s":""})`,size:6,cor:"rgba(200,200,200,0.3)",count:e}),a=1;const n=s.length,l=Math.max(2,Math.round(1+3.3*v(n||1))),c=Math.ceil((r-a+1)/l),u=40;for(let e=0;e<l;e++){const o=a+e*c,n=a+(e+1)*c-1;if(o>r)break;const d=s.filter((e=>e>=o&&e<=n)).length,p=`${o} |---| ${n} (${d} po\xe7o${d>1?"s":""})`,m=6+e*(u/l);i.push({label:p,size:m,cor:t,count:d})}}return i}(a,o).reverse();return _||(r=r.filter((e=>e.count>0||e.label.startsWith("| 0 |")))),{tipo:e,rows:r}}))}),[c,_,M,$,F,N]),Y=Array.isArray(F)&&F.length>0||Array.isArray(N)&&N.length>0;return(0,e.jsx)("div",{css:x,ref:H},(0,e.jsx)(e.Global,{styles:b}),(0,e.jsx)("label",{css:w},"Selecione a distribui\xe7\xe3o"),(0,e.jsx)("select",{css:C,value:s,onChange:e=>l(e.target.value)},(0,e.jsx)("option",{value:""},"Selecione o tipo"),(0,e.jsx)("option",{value:"sample"},"Distribui\xe7\xe3o de amostra")),"sample"===s&&(0,e.jsx)(e.React.Fragment,null,V&&(0,e.jsx)("div",{style:{marginBottom:8}},"Carregando base completa\u2026"),!!q&&(0,e.jsx)("div",{style:{color:"#b00",marginBottom:8}},"Erro: ",q),M&&J&&(0,e.jsx)("div",{style:{marginBottom:8}},"Carregando intervalo de interesse\u2026"),M&&!!Q&&(0,e.jsx)("div",{style:{color:"#b00",marginBottom:8}},"Erro: ",Q),Y&&(0,e.jsx)("div",{css:O},f.map((t=>(0,e.jsx)("div",{key:t,css:P,onClick:()=>{return e=t,g((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]));var e}},(0,e.jsx)("input",{type:"checkbox",checked:c.includes(t),readOnly:!0,style:{marginRight:6}}),(0,e.jsx)("span",null,t.charAt(0).toUpperCase()+t.slice(1))))))),K.length>0&&(0,e.jsx)("div",{css:A},(0,e.jsx)("label",{css:R,title:"Exibir tamb\xe9m classes sem po\xe7os"},(0,e.jsx)("input",{type:"checkbox",checked:_,onChange:e=>I(e.target.checked)}),"Exibir classes vazias"),L&&(0,e.jsx)("label",{css:R,title:"Quando marcado, aplica o filtro de Intervalo de Interesse (c\xf3digos vindos do Explora ou via API)"},(0,e.jsx)("input",{type:"checkbox",checked:M,onChange:e=>k(e.target.checked)}),"Intervalo de interesse")),K.length>0&&(0,e.jsx)("div",{css:j},K.map((t=>(0,e.jsx)(e.React.Fragment,{key:t.tipo},(0,e.jsx)("div",{css:e.css`font-weight:600; margin:4px 0;`},M?"Intervalo de Interesse - ":"",t.tipo.charAt(0).toUpperCase()+t.tipo.slice(1)),t.rows.map(((o,a)=>(0,e.jsx)("div",{key:`${t.tipo}-${a}`,css:S},(0,e.jsx)("div",{css:y},(0,e.jsx)("svg",{width:o.size,height:o.size},(0,e.jsx)("circle",{cx:o.size/2,cy:o.size/2,r:o.size/2,fill:o.cor}))),(0,e.jsx)("span",{css:E},o.label)))))))),(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:null===(a=o.useMapWidgetIds)||void 0===a?void 0:a[0],onActiveViewChange:i}))}function I(e){l.p=e}})(),c})())}}}));