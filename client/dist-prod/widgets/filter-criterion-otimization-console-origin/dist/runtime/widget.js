System.register(["jimu-core/react","jimu-arcgis","esri/config","esri/layers/FeatureLayer","esri/geometry/Extent","esri/layers/GroupLayer","esri/Basemap"],(function(e,t){var o={},r={},s={},a={},n={},i={},l={};return{setters:[function(e){o.default=e.default,o.useEffect=e.useEffect,o.useRef=e.useRef,o.useState=e.useState},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){s.default=e.default},function(e){a.default=e.default},function(e){n.default=e.default},function(e){i.default=e.default},function(e){l.default=e.default}],execute:function(){e((()=>{var e={692:e=>{"use strict";e.exports=l},725:e=>{"use strict";e.exports=s},420:e=>{"use strict";e.exports=n},633:e=>{"use strict";e.exports=a},750:e=>{"use strict";e.exports=i},686:e=>{"use strict";e.exports=r},972:e=>{"use strict";e.exports=o}},t={};function c(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,c),s.exports}c.d=(e,t)=>{for(var o in t)c.o(t,o)&&!c.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var u={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(u),c.d(u,{__set_webpack_public_path__:()=>g,default:()=>f});var e=c(972),t=c(686),o=c(725),r=c(633),s=c(420),a=c(750),n=c(692),i=function(e,t,o,r){return new(o||(o=Promise))((function(s,a){function n(e){try{l(r.next(e))}catch(e){a(e)}}function i(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,i)}l((r=r.apply(e,t||[])).next())}))};o.default.request.interceptors.push({urls:/\/(FeatureServer|MapServer)\/\d+\/query$/i,before:e=>{e.requestOptions.method="post"}}),o.default.request.interceptors.push({urls:/Pocos_Sem_Simbolos\/FeatureServer\/0/i,before:e=>{e.requestOptions.query=Object.assign(Object.assign({},e.requestOptions.query||{}),{f:"json"})}});const l="https://basegis.petrobras.com.br/arcgis/rest/services/EXPLORA/Pocos_Sem_Simbolos/FeatureServer/0",d=500,p=new s.default({xmin:-74,ymin:-34,xmax:-34,ymax:5,spatialReference:{wkid:4326}});function f(o){var s;const c=(0,e.useRef)(),[u,f]=(0,e.useState)(null),[g,m]=(0,e.useState)([]),y=["https://localhost:3001","https://portalgis.petrobras.com.br","http://localhost:8080","https://explorad.petrobras.com.br","https://explorah.petrobras.com.br","https://explora.petrobras.com.br"];return(0,e.useEffect)((()=>{const e=e=>{if(!y.includes(e.origin))return void console.warn("\u26a0\ufe0f Origem n\xe3o permitida:",e.origin);const{type:t,data:o}=e.data||{};"codigosPocos"===t&&Array.isArray(o)&&(console.log("\u{1f4e5} Recebidos codigosPocos:",o.length,"| amostra:",o.slice(0,5)),m(o))};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)}),[]),(0,e.useEffect)((()=>{u&&(console.log("\u2705 Widget pronto! Enviando postMessage agora..."),window.parent.postMessage({type:"widgetReady"},"*"))}),[u]),(0,e.useEffect)((()=>{console.log("\u23f1\ufe0f useEffect plotagem | ready:",!!u,"| nCodigos:",g.length),u&&g.length>0?(console.warn("\u{1f680} Disparando desenharComSimbologiaDoServico (1 layer + filtro por OBJECTIDs)..."),function(e,t){i(this,void 0,void 0,(function*(){console.log("\u{1f3af} desenharComSimbologiaDoServico()","qtd:",t.length,"amostra:",t.slice(0,5));const o=e.view;try{o&&(o.extent=p)}catch(e){}const s=o.map;let n=s.layers.find((e=>"pocos-group"===e.id));n||(n=new a.default({id:"pocos-group",title:"Po\xe7os",visibilityMode:"inherited",listMode:"show"}),s.add(n),console.log('\u{1f9f1} Criado GroupLayer "Po\xe7os".'));let i=n.layers.find((e=>"pocos-base"===e.id));i?(yield i.load(),console.log("\u267b\ufe0f Reutilizando FeatureLayer base.")):(i=new r.default({id:"pocos-base",url:l,title:"Po\xe7os (base)",listMode:"show",popupEnabled:!1,outFields:["POCO_CD_POCO"]}),n.add(i),yield i.load(),console.log("\u2795 FeatureLayer base criado e carregado."));const c=i.fields.find((e=>"POCO_CD_POCO"===e.name)),u="string"===(null==c?void 0:c.type);console.log("\u{1f50e} Campo POCO_CD_POCO tipo:",null==c?void 0:c.type,"| precisaAspas:",!!u);const f=Array.from(new Set(t.map(String).map((e=>e.trim())).filter(Boolean)));if(0===f.length)return void console.warn("\u26d4 Nada a plotar (lista vazia ap\xf3s deduplica\xe7\xe3o).");const g=[];for(let e=0;e<f.length;e+=d)g.push(f.slice(e,e+d));const m=e=>u?`'${e.replace(/'/g,"''")}'`:e,y=g.map((e=>`POCO_CD_POCO IN (${e.map(m).join(",")})`));console.time("\u23f1\ufe0f queryObjectIds(paralelo)");const h=yield Promise.all(y.map((e=>i.queryObjectIds({where:e}))));console.timeEnd("\u23f1\ufe0f queryObjectIds(paralelo)");const b=Array.from(new Set(h.flat()));console.log(`\u2705 OBJECTIDs coletados: ${b.length}`);(yield o.whenLayerView(i)).filter={objectIds:b};try{const e=5e3,t=f.slice(0,e),o=i.createQuery();o.where=`POCO_CD_POCO IN (${t.map(m).join(",")})`,o.outFields=["POCO_CD_POCO"],o.returnDistinctValues=!0,o.returnGeometry=!1;const r=yield i.queryFeatures(o),s=new Set(r.features.map((e=>String(e.attributes.POCO_CD_POCO).trim()))),a=t.filter((e=>!s.has(e)));console.warn(`\u{1f3c1} Distintos retornados (amostra ${s.size}/${t.length}); faltantes\u2248 ${a.length} (na amostra).`)}catch(e){console.debug("\u2139\ufe0f Pulo checagem de faltantes (lista grande/n\xe3o necess\xe1ria).",e)}console.warn("\u{1f3c1} Plotagem conclu\xedda (1 layer + filtro por OBJECTIDs).")}))}(u,g)):(u||console.log("\u2026 aguardando mapViewReady (onActiveViewChange)"),0===g.length&&console.log("\u2026 aguardando codigosPocos (postMessage)"))}),[u,g]),e.default.createElement("div",{style:{height:"100%",width:"100%"}},e.default.createElement(t.JimuMapViewComponent,{useMapWidgetId:null===(s=o.useMapWidgetIds)||void 0===s?void 0:s[0],onActiveViewChange:e=>{if(!e)return;c.current=e,f(e);const t=e.view.map;try{t.basemap=n.default.fromId("osm")}catch(e){}t.layers.forEach((e=>{var t;if("map-image"===e.type&&/\/Contexto\/MapServer/i.test(e.url)){const t=e.findSublayerById(14);t&&(t.visible=!1,t.listMode="hide")}(null===(t=e.url)||void 0===t?void 0:t.includes("/Contexto/MapServer/14"))&&(e.visible=!1,e.listMode="hide")})),console.log("\u{1f5fa}\ufe0f onActiveViewChange conclu\xeddo. Basemap/sublayers ajustados.")}}))}function g(e){c.p=e}})(),u})())}}}));