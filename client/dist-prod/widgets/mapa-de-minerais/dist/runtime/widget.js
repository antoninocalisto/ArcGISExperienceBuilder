System.register(["jimu-core","jimu-arcgis","esri/layers/FeatureLayer","esri/widgets/Legend","esri/renderers/ClassBreaksRenderer","esri/symbols/SimpleMarkerSymbol"],(function(e,t){var o={},r={},i={},a={},n={},s={};return{setters:[function(e){o.Global=e.Global,o.React=e.React,o.css=e.css,o.jsx=e.jsx},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.default=e.default},function(e){a.default=e.default},function(e){n.default=e.default},function(e){s.default=e.default}],execute:function(){e((()=>{var e={633:e=>{"use strict";e.exports=i},841:e=>{"use strict";e.exports=n},417:e=>{"use strict";e.exports=s},828:e=>{"use strict";e.exports=a},686:e=>{"use strict";e.exports=r},244:e=>{"use strict";e.exports=o}},t={};function l(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,l),i.exports}l.d=(e,t)=>{for(var o in t)l.o(t,o)&&!l.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var c={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(c),l.d(c,{__set_webpack_public_path__:()=>te,default:()=>ee});var e=l(244),t=l(686),o=l(633),r=l(828),i=l(841),a=l(417),n=function(e,t,o,r){return new(o||(o=Promise))((function(i,a){function n(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,s)}l((r=r.apply(e,t||[])).next())}))};const s={lateral:"rgba(88, 19, 252, 0.7)",testemunho:"rgba(255, 0, 255, 0.7)",calha:"rgba(245, 201, 38, 0.7)",plug:"rgba(125, 253, 148, 0.7)","whole core":"rgba(255, 43, 24, 0.7)"};function u(e){return n(this,arguments,void 0,(function*({jimuMapView:e,dados:t,colorFill:n,idCamada:s,idLegenda:l,titleLegenda:c}){const u=e.view,d=u.map,p=`POCO_CD_POCO IN (${t.map((e=>e.codigoPoco)).join(",")})`,m=new o.default({url:"https://basegis.petrobras.com.br/arcgis/rest/services/EXPLORA/Feature_Pocos/MapServer/0",definitionExpression:p,title:"Po\xe7os",outFields:["*"],visible:!1});yield m.load();const f=(yield m.queryFeatures({where:p,outFields:["*"],returnGeometry:!0})).features.map((e=>{const o=t.find((t=>t.codigoPoco===e.attributes.POCO_CD_POCO));return e.attributes.POCO_MD_MERID_CENT=o?o.total:0,e})),v=t.map((e=>e.total));let g=Math.min(...v),b=Math.max(...v);const h=[],y={color:"black",width:"1px"};if(g===b&&0===g)h.push({minValue:0,maxValue:0,label:"N\xe3o h\xe1 dados suficientes",symbol:new a.default({color:"rgba(255,255,255,0)",size:0,style:"circle",outline:y})});else{const e=v.filter((e=>0===e)).length,t=v.filter((e=>e>0));e>0&&h.push({minValue:0,maxValue:0,label:`| 0 | (${e} po\xe7o${e>1?"s":""})`,symbol:new a.default({color:"rgba(200,200,200,0.3)",size:6,style:"circle",outline:y})}),g=1;const o=t.length,r=Math.max(2,Math.round(1+3.3*Math.log10(o))),i=Math.ceil((b-g+1)/r),s=40;for(let e=0;e<r;e++){const o=g+e*i,l=g+(e+1)*i-1;if(o>b)break;const c=t.filter((e=>e>=o&&e<=l)).length,u=`${o} |---| ${l} (${c} po\xe7o${c>1?"s":""})`,d=6+e*(s/r);h.push({minValue:o,maxValue:l,label:u,symbol:new a.default({color:n,size:d,style:"circle",outline:y})})}}const x=new i.default({field:"POCO_MD_MERID_CENT",classBreakInfos:h}),w=new o.default({id:s,source:f,fields:m.fields,objectIdField:"OBJECTID",geometryType:"point",spatialReference:{wkid:102100},renderer:x,title:c,listMode:"hide"}),R=d.findLayerById(s);R&&d.remove(R),d.add(w);new r.default({view:u,layerInfos:[{layer:w,title:c}]})}))}var d=function(e,t,o,r){return new(o||(o=Promise))((function(i,a){function n(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,s)}l((r=r.apply(e,t||[])).next())}))};const p=[{value:"DRX-TOT",label:"DRX-Total"},{value:"DRX-ARG",label:"DRX-Argilominerais"},{value:"MASSA",label:"Qemscan-Massa"},{value:"AREA",label:"Qemscan-\xc1rea"},{value:"todasAnalises",label:"Todas as An\xe1lises"}];function m(e,t,o,r){return new Promise(((i,a)=>{const n=Math.random().toString(36).slice(2);let s="*";try{document.referrer&&(s=new URL(document.referrer).origin)}catch(e){}const l=e=>{const t=e.data||{};t.reqId===n&&(t.type===o?(window.removeEventListener("message",l),i(t.payload)):t.type===r&&(window.removeEventListener("message",l),a(new Error(t.message||"Erro no fetch via parent"))))};window.addEventListener("message",l),window.parent.postMessage({type:e,body:t,reqId:n},s)}))}function f(e,t){return d(this,void 0,void 0,(function*(){const o=function(e,t){const o=new URLSearchParams;return o.set("hdSys","novaintcons"),o.set("hdUC","Mapa"),o.set("hdAcao","CarregarMapaDistribuicaoMineraisContador"),o.set("hdSessionFilter","true"),o.set("tipoAnalise",e),o.set("faixaInteresse",String(!!t)),o.toString()}(e,t),r=yield m("fetchDistribuicaoMinerais",o,"fetchDistribuicaoMinerais:ok","fetchDistribuicaoMinerais:err");return i=r,(Array.isArray(i)?i:[]).map((e=>{var t,o,r,i,a,n;return{codigoPoco:Number(null!==(i=null!==(r=null!==(o=null!==(t=e.codigoPoco)&&void 0!==t?t:e.POCO_CD_POCO)&&void 0!==o?o:e.poco)&&void 0!==r?r:e.codigo)&&void 0!==i?i:0),totalMinerais:Number(null!==(n=null!==(a=e.totalMinerais)&&void 0!==a?a:e.total)&&void 0!==n?n:0)}})).filter((e=>!!e.codigoPoco));var i}))}function v(e,t){return d(this,void 0,void 0,(function*(){const o=function(e,t){const o=new URLSearchParams;return o.set("hdSys","novaintcons"),o.set("hdUC","Mapa"),o.set("hdAcao","CarregarMapaDistribuicaoMineraisLista"),o.set("hdSessionFilter","true"),o.set("tipoAnalise",e),o.set("faixaInteresse",String(!!t)),o.toString()}(e,t),r=yield m("fetchDistribuicaoMinerais",o,"fetchDistribuicaoMinerais:ok","fetchDistribuicaoMinerais:err");return i=r,(Array.isArray(i)?i:[]).map((e=>{var t,o,r,i,a;return{nomeMineral:String(null!==(r=null!==(o=null!==(t=e.nomeMineral)&&void 0!==t?t:e.nome)&&void 0!==o?o:e.mineral)&&void 0!==r?r:"").trim(),nomeResumidoMineral:null!==(a=null!==(i=e.nomeResumidoMineral)&&void 0!==i?i:e.nomeResumido)&&void 0!==a?a:void 0}})).filter((e=>!!e.nomeMineral));var i}))}function g(e,t,o){return d(this,void 0,void 0,(function*(){const r=function(e,t,o){const r=new URLSearchParams;return r.set("hdSys","novaintcons"),r.set("hdUC","Mapa"),r.set("hdAcao","CarregarMapaDistribuicaoMineraisAgrupador"),r.set("hdSessionFilter","true"),r.set("tipoAnalise",e),t&&r.set("nomeResumidoMineral",t),r.set("faixaInteresse",String(!!o)),r.toString()}(e,t,o),i=yield m("fetchDistribuicaoMinerais",r,"fetchDistribuicaoMinerais:ok","fetchDistribuicaoMinerais:err");return a=i,(Array.isArray(a)?a:[]).map((e=>{var t,o,r,i,a,n,s,l,c,u,d,p;return{codigoPoco:Number(null!==(i=null!==(r=null!==(o=null!==(t=e.codigoPoco)&&void 0!==t?t:e.POCO_CD_POCO)&&void 0!==o?o:e.poco)&&void 0!==r?r:e.codigo)&&void 0!==i?i:0),nomeResumido:null!==(n=null!==(a=e.nomeResumido)&&void 0!==a?a:e.nomeResumidoMineral)&&void 0!==n?n:void 0,qtAnalise:Number(null!==(l=null!==(s=e.qtAnalise)&&void 0!==s?s:e.total)&&void 0!==l?l:0),valorMedio:Number(null!==(u=null!==(c=e.valorMedio)&&void 0!==c?c:e.media)&&void 0!==u?u:0),valorMaximo:Number(null!==(p=null!==(d=e.valorMaximo)&&void 0!==d?d:e.maximo)&&void 0!==p?p:0)}})).filter((e=>!!e.codigoPoco));var a}))}const b=e=>`minerais_${String(e).toLowerCase()}`,h=e=>`lgd_${b(e)}`;function y(e){try{if(!e)return;e.featureReduction&&"cluster"===e.featureReduction.type&&(e.featureReduction=Object.assign(Object.assign({},e.featureReduction),{labelsVisible:!1})),"labelsVisible"in e&&(e.labelsVisible=!1),"labelingInfo"in e&&(e.labelingInfo=[]),Array.isArray(e.sublayers)&&e.sublayers.forEach((e=>y(e)))}catch(e){}}function x(e,t,o,r){const{view:i}=e;if(!i||!Array.isArray(t)||0===t.length)return;const a=t.map((e=>({codigoPoco:e.codigoPoco,total:e.totalMinerais}))),n=b(o);u({jimuMapView:e,dados:a,colorFill:"rgb(253,142,55)",idCamada:n,idLegenda:h(o),titleLegenda:(r?"Intervalo de Interesse - ":"")+w(o),withInterest:r});const s=i.map.findLayerById(n);s&&y(s)}function w(e){var t;const o=p.find((t=>t.value===e));return null!==(t=null==o?void 0:o.label)&&void 0!==t?t:String(e)}var R=function(e,t,o,r){return new(o||(o=Promise))((function(i,a){function n(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,s)}l((r=r.apply(e,t||[])).next())}))};const M=!1,P=360,A=50,C=10,S=650,j={lateral:"totalAmostrasLaterais",testemunho:"totalTestemunhos",calha:"totalCalhas",plug:"totalPlugs","whole core":"totalWholeCore"},E=Object.keys(j),I=e=>Math.log10?Math.log10(e):Math.log(e)/Math.LN10;function k(e){return new Promise(((t,o)=>{const r=Math.random().toString(36).slice(2);let i="*";try{document.referrer&&(i=new URL(document.referrer).origin)}catch(e){}const a=e=>{const i=e.data||{};var n;i.reqId===r&&("fetchDistribuicaoAmostras:ok"===i.type?(window.removeEventListener("message",a),t((n=i.payload,(Array.isArray(n)?n:[]).map((e=>{var t,o,r,i,a,n,s,l,c,u,d,p,m,f;return{codigoPoco:Number(null!==(i=null!==(r=null!==(o=null!==(t=e.codigoPoco)&&void 0!==t?t:e.POCO_CD_POCO)&&void 0!==o?o:e.poco)&&void 0!==r?r:e.codigo)&&void 0!==i?i:0),totalAmostrasLaterais:Number(null!==(n=null!==(a=e.totalAmostrasLaterais)&&void 0!==a?a:e.laterais)&&void 0!==n?n:0),totalCalhas:Number(null!==(l=null!==(s=e.totalCalhas)&&void 0!==s?s:e.calhas)&&void 0!==l?l:0),totalPlugs:Number(null!==(u=null!==(c=e.totalPlugs)&&void 0!==c?c:e.plugs)&&void 0!==u?u:0),totalTestemunhos:Number(null!==(p=null!==(d=e.totalTestemunhos)&&void 0!==d?d:e.testemunhos)&&void 0!==p?p:0),totalWholeCore:Number(null!==(f=null!==(m=e.totalWholeCore)&&void 0!==m?m:e.wholeCore)&&void 0!==f?f:0)}})).filter((e=>!!e.codigoPoco))))):"fetchDistribuicaoAmostras:err"===i.type&&(window.removeEventListener("message",a),o(new Error(i.message||"Erro no fetch via parent"))))};window.addEventListener("message",a),window.parent.postMessage({type:"fetchDistribuicaoAmostras",body:e,reqId:r},i)}))}function O(){return R(this,arguments,void 0,(function*(e=!1){const t=function(e){const t=new URLSearchParams;return t.set("hdSys","novaintcons"),t.set("hdUC","Mapa"),t.set("hdAcao","CarregarMapaDistribuicaoAmostrasContador"),t.set("hdSessionFilter","true"),t.set("faixaInteresse",String(!!e)),t.toString()}(e);return k(t)}))}const L=e.css`
  div[role='dialog'][aria-label='mapa-de-distribuicao'],
  div[role='dialog'][aria-label='mapa-de-distribuicao-v2'] {
    position: absolute !important;
    inset: ${A}px ${C}px auto auto !important;
    transform: none !important;
    z-index: 9999 !important;
    width: ${P}px !important;
    height: ${S}px !important;
    max-height: calc(100% - 24px) !important;
    overflow: visible !important;
  }
`,D=e.css`font-weight:600;margin:4px 0;font-size:.85rem;line-height:1.1;`,N=e.css`width:${40}px;height:${40}px;display:flex;align-items:center;justify-content:center;margin-right:8px;`,_=e.css`position:relative;width:100%;height:100%;background:#fff;border:1px solid #ddd;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,.1);padding:16px;overflow:hidden;`,F=e.css`font-weight:600;margin-bottom:4px;display:block;`,$=e.css`width:100%;padding:6px 8px;margin-bottom:12px;border:1px solid #ccc;border-radius:4px;`,V=e.css`
  overflow: visible;
  margin-bottom: 8px;
  padding: 4px;
  background: #fafafa;
  border: 1px solid #eee;
  border-radius: 4px;
  display: grid;
  grid-template-rows: repeat(2, minmax(24px, auto));
  grid-auto-flow: column;
  grid-auto-columns: minmax(140px, 1fr);
  column-gap: 4px;
  row-gap: 2px;
  align-items: start;
`,z=e.css`
  display: inline-grid;
  grid-template-columns: auto 1fr;
  align-items: center;
  column-gap: 6px;
  padding: 1px 2px;
  border-radius: 3px;
  cursor: pointer;
  user-select: none;
  min-width: 0;
  box-sizing: border-box;
  overflow: hidden;

  & > * { margin: 0 !important; padding: 0 !important; }
  input[type='checkbox'], input[type='radio'] { width: 14px; height: 14px; margin: 0 !important; flex: 0 0 auto; }

  .lbl { min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-size: .84rem; line-height: 1.15; padding-bottom: 1px; }
`,T=e.css`
  overflow: visible;
  margin-bottom: 8px;
  padding: 4px;
  background: #fafafa;
  border: 1px solid #eee;
  border-radius: 4px;

  display: grid;
  grid-template-columns: minmax(140px, 1fr) minmax(140px, 1fr);
  grid-template-rows: repeat(3, minmax(24px, auto));
  column-gap: 4px;
  row-gap: 2px;
  align-items: start;

  /* DRX-Total (Row1, Col1) */
  label[data-key='DRX-TOT'] {
    grid-column: 1;
    grid-row: 1;
  }
  /* Qemscan-Massa (Row1, Col2) */
  label[data-key='MASSA'] {
    grid-column: 2;
    grid-row: 1;
  }
  /* DRX-Argilominerais (Row2, Col1) */
  label[data-key='DRX-ARG'] {
    grid-column: 1;
    grid-row: 2;
  }
  /* Qemscan-Área (Row2, Col2) */
  label[data-key='AREA'] {
    grid-column: 2;
    grid-row: 2;
  }
  /* "Todas as Análises" (Row3, ocupando 2 colunas) */
  label[data-key='todasAnalises'] {
    grid-column: 1 / span 2;
    grid-row: 3;
  }
`,B=e.css`max-height:300px;overflow-y:auto;margin-top:8px;padding:8px 8px 36px;background:#fff;border:1px solid #ddd;border-radius:4px;position:relative;`,U=e.css`display:flex;align-items:center;margin:2px;`,q=e.css`font-size:.78rem;line-height:1.1;`,X=e.css`position: sticky; bottom: 0; background: #fff; border-top: 1px solid #eee; padding: 4px 0; display: flex; flex-direction: column; align-items: flex-start; gap: 6px;`,G=e.css`display:flex;align-items:center;gap:6px;padding-left:.5em;cursor:pointer;font-size:.9rem;`,W=G;function Q(e){var t;let o=e;for(;o;){if(o.getAttribute&&"dialog"===o.getAttribute("role"))return o;o=null!==(t=null==o?void 0:o.parentElement)&&void 0!==t?t:null}return null}function J(e){const t=getComputedStyle(e);return"true"===e.getAttribute("aria-hidden")||"none"===t.display||"hidden"===t.visibility}let Y=!1;function H(e){if(!Y){Y=!0;try{const t=e.style;"absolute"!==t.getPropertyValue("position")&&t.setProperty("position","absolute","important"),t.removeProperty("left"),t.removeProperty("bottom"),t.removeProperty("transform"),t.setProperty("inset","auto auto auto auto"),t.setProperty("top",`${A}px`,"important"),t.setProperty("right",`${C}px`,"important"),t.getPropertyValue("width")!==`${P}px`&&t.setProperty("width",`${P}px`,"important"),t.getPropertyValue("height")!==`${S}px`&&t.setProperty("height",`${S}px`,"important"),"calc(100% - 24px)"!==t.getPropertyValue("max-height")&&t.setProperty("max-height","calc(100% - 24px)","important"),"visible"!==t.getPropertyValue("overflow")&&t.setProperty("overflow","visible","important"),"9999"!==t.getPropertyValue("z-index")&&t.setProperty("z-index","9999","important")}finally{Y=!1}}}const K=e=>`amostras_${e.replace(/\s+/g,"_")}`;function Z(e){try{if(!e)return;e.featureReduction&&"cluster"===e.featureReduction.type&&(e.featureReduction=Object.assign(Object.assign({},e.featureReduction),{labelsVisible:!1})),"labelsVisible"in e&&(e.labelsVisible=!1),"labelingInfo"in e&&(e.labelingInfo=[]),Array.isArray(e.sublayers)&&e.sublayers.forEach((e=>Z(e)))}catch(e){}}function ee(o){var r;const[i,a]=e.React.useState(),[n,l]=e.React.useState(""),[c,m]=e.React.useState([]),[h,y]=e.React.useState(!1),[w,P]=e.React.useState(!1),[S,k]=e.React.useState(!1),[ee,te]=e.React.useState((()=>new Set((Array.isArray(null==o?void 0:o.codigosFaixaInteresse)?o.codigosFaixaInteresse:[]).map((e=>Number(e))).filter((e=>!isNaN(e)))))),[oe,re]=e.React.useState(null),[ie,ae]=e.React.useState(null),[ne,se]=e.React.useState(""),[le,ce]=e.React.useState([]),[ue,de]=e.React.useState(""),[pe,me]=e.React.useState(null),[fe,ve]=e.React.useState(""),[ge,be]=e.React.useState(null),[he,ye]=e.React.useState(!1),[xe,we]=e.React.useState(""),[Re,Me]=e.React.useState(!1),[Pe,Ae]=e.React.useState(!1),[Ce,Se]=e.React.useState(""),[je,Ee]=e.React.useState(""),Ie=e.React.useRef(null);!function(t){e.React.useEffect((()=>{let e=null;const o=()=>{const o=t.current&&t.current.closest('[role="dialog"]')||document.querySelector('div[role="dialog"][aria-label="mapa-de-distribuicao-v2"]')||document.querySelector('div[role="dialog"][aria-label="mapa-de-distribuicao"]');if(!o)return;H(o);const r=new MutationObserver((e=>{if(!Y&&e.some((e=>"style"===e.attributeName))){const e=o.style;("absolute"!==e.getPropertyValue("position")||e.getPropertyValue("top")!==`${A}px`||e.getPropertyValue("right")!==`${C}px`||e.transform&&"none"!==e.transform)&&H(o)}}));let i;r.observe(o,{attributes:!0,attributeFilter:["style"]});const a=()=>{clearTimeout(i),i=setTimeout((()=>H(o)),80)};window.addEventListener("resize",a),e=()=>{r.disconnect(),window.removeEventListener("resize",a)}};return requestAnimationFrame(o),setTimeout(o,80),setTimeout(o,300),()=>{null==e||e()}}),[t])}(Ie);const ke=e.React.useRef(!1);e.React.useEffect((()=>{const e=e=>{const t=null==e?void 0:e.data;if(!t||"faixa-interesse"!==t.type||!Array.isArray(t.codigosPocos))return;const o=t.codigosPocos.map((e=>Number(e))).filter((e=>!isNaN(e)));te(new Set(o)),o.length>0&&(k(!0),ke.current||P(!0))};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)}),[]),e.React.useEffect((()=>{ee.size>0&&(k(!0),ke.current||P(!0))}),[ee]),e.React.useEffect((()=>{let e=!1;return function(){R(this,void 0,void 0,(function*(){if("sample"===n){Me(!0),Se("");try{const t=yield O(w||M);e||re(t)}catch(t){e||(Se((null==t?void 0:t.message)||"Falha ao buscar dados"),re([]))}finally{e||Me(!1)}}}))}(),()=>{e=!0}}),[n,w]),e.React.useEffect((()=>{let e=!1;return function(){R(this,void 0,void 0,(function*(){if("sample"===n&&w&&!(ee.size>0)&&null===ie){Ae(!0),Ee("");try{const t=yield O(!0);e||ae(t)}catch(t){e||(Ee((null==t?void 0:t.message)||"Falha ao buscar dados do intervalo de interesse"),ae([]))}finally{e||Ae(!1)}}}))}(),()=>{e=!0}}),[n,w,ee,ie]),e.React.useEffect((()=>{var e;const t=i;if(!(null==t?void 0:t.view))return;if("sample"!==n)return;const o=w?ee.size>0?(null!=oe?oe:[]).filter((e=>ee.has(Number(e.codigoPoco)))):null!==(e=null!=ie?ie:oe)&&void 0!==e?e:[]:null!=oe?oe:[];if(!Array.isArray(o)||0===o.length)return;if(!Array.isArray(c)||0===c.length)return;const{view:r}=t;c.forEach((e=>{const i=o.map((t=>{var o;return{codigoPoco:t.codigoPoco,total:null!==(o=t[j[e]])&&void 0!==o?o:0}})).filter((e=>{var t;return(null!==(t=e.total)&&void 0!==t?t:0)>0}));if(function(e,t){try{const o=e.map.findLayerById(K(t));o&&e.map.remove(o)}catch(e){}}(r,e),0===i.length)return;const a=s[e]||"rgba(0,0,0,0.5)",n=K(e),l=`lgd_${n}`;try{u({jimuMapView:t,dados:i,colorFill:a,idCamada:n,idLegenda:l,titleLegenda:(w?"Intervalo de Interesse - ":"")+(e.charAt(0).toUpperCase()+e.slice(1)),withInterest:w});const o=r.map.findLayerById(n);o&&Z(o)}catch(e){console.error(`[amostras] falha ao gerar camada ${n}`,e)}}))}),[i,c,w,ee,oe,ie,n]),e.React.useEffect((()=>{let e=!1;return function(){R(this,void 0,void 0,(function*(){if("minerals"===n&&ne){me(null),ve(""),ce([]),de(""),we(""),ye(!0);try{const[t,o]=yield Promise.all([f(ne,w),v(ne,w)]);e||(be(t),ce(o))}catch(t){e||(we((null==t?void 0:t.message)||"Falha ao buscar minerais"),be([]),ce([]))}finally{e||ye(!1)}}}))}(),()=>{e=!0}}),[n,ne,w]),e.React.useEffect((()=>{if("minerals"!==n)return;if(!(null==i?void 0:i.view))return;if(!ne)return;if(!Array.isArray(ge))return;const e=w&&ee.size>0?ge.filter((e=>ee.has(Number(e.codigoPoco)))):ge;0!==e.length&&x(i,e,ne,w)}),[i,n,ne,ge,w,ee]),e.React.useEffect((()=>{let e=!1;return function(){R(this,void 0,void 0,(function*(){if("minerals"===n&&(null==i?void 0:i.view)&&ne&&pe&&fe)try{const t=yield g(ne,pe.nomeResumidoMineral,w);e||(yield function(e,t,o,r){return d(this,void 0,void 0,(function*(){var i,a,n,s,l,c,u,d,p;const{view:m}=e,f=null===(i=null==m?void 0:m.map)||void 0===i?void 0:i.findLayerById(b(t));if(!f)return;if(!Array.isArray(o)||0===o.length)return;const v=new Map;for(const e of o)v.set(Number(e.codigoPoco),e);const g="md_val",h=yield f.queryFeatures({where:"1=1",returnGeometry:!0,outFields:["*"]}),y=[];let x=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY;for(const e of h.features){const t=Number(null!==(u=null!==(l=null!==(n=null===(a=e.attributes)||void 0===a?void 0:a.POCO_CD_POCO)&&void 0!==n?n:null===(s=e.attributes)||void 0===s?void 0:s.codigoPoco)&&void 0!==l?l:null===(c=e.attributes)||void 0===c?void 0:c.poco)&&void 0!==u?u:null===(d=e.attributes)||void 0===d?void 0:d.codigo),o=v.get(t);let i=0;o&&(i="analise"===r?o.qtAnalise:"media"===r?o.valorMedio:o.valorMaximo),e.attributes[g]=i,x=Math.min(x,i),w=Math.max(w,i),y.push(e)}y.length>0&&(yield f.applyEdits({updateFeatures:y}));const R=w-x,M=e=>"analise"===r?`${e}`:`${e} %`;let P;if(R<3)P=[{value:x,color:"rgb(249,238,225)",label:M(x)},{value:w,color:"rgb(165,60,2)",label:M(w)}];else if(R<5){const e=Math.round(R/4)||1;P=[{value:x,color:"rgb(249,238,225)",label:M(x)},{value:x+2*e,color:"rgb(253,142,55)",label:M(x+2*e)},{value:w,color:"rgb(165,60,2)",label:M(w)}]}else{const e=Math.round(R/4)||1;P=[{value:x,color:"rgb(249,238,225)",label:M(x)},{value:x+1*e,color:"rgb(251,190,130)",label:M(x+1*e)},{value:x+2*e,color:"rgb(253,142,55)",label:M(x+2*e)},{value:w-1*e,color:"rgb(233,85,6)",label:M(w-1*e)},{value:w,color:"rgb(165,60,2)",label:M(w)}]}const A=(null===(p=f.renderer)||void 0===p?void 0:p.clone)?f.renderer.clone():f.renderer,C={type:"color",field:g,legendOptions:{title:""},stops:P};A.visualVariables=[C],f.renderer=A}))}(i,ne,t,fe))}catch(e){console.error("Falha ao aplicar coloriza\xe7\xe3o por agrupador",e)}}))}(),()=>{e=!0}}),[i,n,ne,pe,fe,w]);const Oe=e.React.useCallback((()=>{m([]),y(!1),P(!1),l(""),re(null),ae(null),se(""),be(null),we(""),ye(!1),ce([]),de(""),me(null),ve(""),ke.current=!1}),[]),Le=e.React.useCallback((()=>{const e=null==i?void 0:i.view;e&&function(e){var t,o,r,i,a,n;try{(null!==(n=null!==(r=null===(o=null===(t=e.map.allLayers)||void 0===t?void 0:t.toArray)||void 0===o?void 0:o.call(t))&&void 0!==r?r:null===(a=null===(i=e.map.layers)||void 0===i?void 0:i.toArray)||void 0===a?void 0:a.call(i))&&void 0!==n?n:[]).forEach((t=>{var o;String(null!==(o=null==t?void 0:t.id)&&void 0!==o?o:"").startsWith("amostras_")&&e.map.remove(t)}))}catch(e){}}(e),Oe()}),[i,Oe]);e.React.useEffect((()=>{if(!(null==i?void 0:i.view))return;const e=Ie.current;if(!e)return;const t=Q(e);if(!t)return;const o=t.querySelector('button[aria-label="Close"], button[title="Close"], button[aria-label="Fechar"], button[title="Fechar"], [data-action="close"]');return o?(o.addEventListener("click",Le),()=>o.removeEventListener("click",Le)):void 0}),[i,Le]),e.React.useEffect((()=>{const e=Ie.current;if(!e)return;const t=Q(e);if(!t)return;let o=!J(t);const r=()=>{const e=J(t);o&&e?(Le(),o=!1):o||e||(o=!0)},i=new MutationObserver(r);return i.observe(t,{attributes:!0,attributeFilter:["style","class","aria-hidden"]}),r(),()=>i.disconnect()}),[Le]),e.React.useEffect((()=>{const e=e=>{"Escape"===e.key&&Le()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[Le]);const De=e.React.useMemo((()=>{var e;if("sample"!==n)return[];const t=w?ee.size>0?(null!=oe?oe:[]).filter((e=>ee.has(Number(e.codigoPoco)))):null!==(e=null!=ie?ie:oe)&&void 0!==e?e:[]:null!=oe?oe:[];return c.map((e=>{const o=s[e],r=t.map((t=>{var o;return{codigoPoco:t.codigoPoco,total:null!==(o=t[j[e]])&&void 0!==o?o:0}}));let i=function(e,t){const o=e.map((e=>e.total));let r=Math.min(...o),i=Math.max(...o);const a=[];if(!isFinite(r)||!isFinite(i))return a;if(0===r&&0===i)a.push({label:"N\xe3o h\xe1 dados suficientes",size:0,cor:t,count:0});else{const e=o.filter((e=>0===e)).length,n=o.filter((e=>e>0));e>0&&a.push({label:`| 0 | (${e} po\xe7o${e>1?"s":""})`,size:6,cor:"rgba(200,200,200,0.3)",count:e}),r=1;const s=n.length,l=Math.max(2,Math.round(1+3.3*I(s||1))),c=Math.ceil((i-r+1)/l),u=30;for(let e=0;e<l;e++){const o=r+e*c,s=r+(e+1)*c-1;if(o>i)break;const d=n.filter((e=>e>=o&&e<=s)).length,p=`${o} |---| ${s} (${d} po\xe7o${d>1?"s":""})`,m=6+e*(u/l);a.push({label:p,size:m,cor:t,count:d})}}return a}(r,o).reverse();return h||(i=i.filter((e=>e.count>0||e.label.startsWith("| 0 |")))),{tipo:e,rows:i}}))}),[c,h,w,ee,oe,ie,n]),Ne=Array.isArray(oe)&&oe.length>0||Array.isArray(ie)&&ie.length>0;e.React.useMemo((()=>{const e=(ue||"").normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase();return(le||[]).filter((t=>(t.nomeMineral||"").normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().includes(e)))}),[le,ue]),p.slice(0,4),p.slice(4);return(0,e.jsx)("div",{css:_,ref:Ie},(0,e.jsx)(e.Global,{styles:L}),(0,e.jsx)("label",{css:F},"Selecione a distribui\xe7\xe3o"),(0,e.jsx)("select",{css:$,value:n,onChange:e=>l(e.target.value)},(0,e.jsx)("option",{value:""},"Selecione o tipo"),(0,e.jsx)("option",{value:"sample"},"Distribui\xe7\xe3o de amostras"),(0,e.jsx)("option",{value:"minerals"},"Distribui\xe7\xe3o de Minerais")),"sample"===n&&(0,e.jsx)(e.React.Fragment,null,Re&&(0,e.jsx)("div",{style:{marginBottom:8}},"Carregando base\u2026"),!!Ce&&(0,e.jsx)("div",{style:{color:"#b00",marginBottom:8}},"Erro: ",Ce),w&&Pe&&(0,e.jsx)("div",{style:{marginBottom:8}},"Carregando intervalo de interesse\u2026"),w&&!!je&&(0,e.jsx)("div",{style:{color:"#b00",marginBottom:8}},"Erro: ",je),Ne&&(0,e.jsx)("div",{css:V},E.map((t=>(0,e.jsx)("label",{key:t,css:z},(0,e.jsx)("input",{type:"checkbox",checked:c.includes(t),onChange:()=>m((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]))}),(0,e.jsx)("span",{className:"lbl"},t.charAt(0).toUpperCase()+t.slice(1))))))),"minerals"===n&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{css:T},p.map((t=>(0,e.jsx)("label",{key:t.value,css:z,"data-key":t.value},(0,e.jsx)("input",{type:"radio",name:"mineral-analise",checked:ne===t.value,onChange:()=>se(t.value)}),(0,e.jsx)("span",{className:"lbl"},t.label))))),he&&(0,e.jsx)("div",{style:{marginBottom:8}},"Carregando minerais\u2026"),!!xe&&(0,e.jsx)("div",{style:{color:"#b00",marginBottom:8}},"Erro: ",xe)),"sample"===n&&De.length>0&&(0,e.jsx)("div",{css:B},De.map((t=>(0,e.jsx)(e.React.Fragment,{key:t.tipo},(0,e.jsx)("div",{css:D},w?"Intervalo de Interesse - ":"",t.tipo.charAt(0).toUpperCase()+t.tipo.slice(1)),t.rows.map(((o,r)=>(0,e.jsx)("div",{key:`${t.tipo}-${r}`,css:U},(0,e.jsx)("div",{css:N},(0,e.jsx)("svg",{width:o.size,height:o.size},(0,e.jsx)("circle",{cx:o.size/2,cy:o.size/2,r:o.size/2,fill:o.cor}))),(0,e.jsx)("span",{css:q},o.label)))))))),(De.length>0||S)&&(0,e.jsx)("div",{css:X},"sample"===n&&De.length>0&&(0,e.jsx)("label",{css:G,title:"Exibir tamb\xe9m classes sem po\xe7os"},(0,e.jsx)("input",{type:"checkbox",checked:h,onChange:e=>y(e.target.checked)}),"Exibir classes vazias"),S&&(0,e.jsx)("label",{css:W,title:"Quando marcado, aplica o filtro de Intervalo de Interesse (c\xf3digos vindos do Explora ou via API)"},(0,e.jsx)("input",{type:"checkbox",checked:w,onChange:e=>{ke.current=!0,P(e.target.checked)}}),"Intervalo de interesse")),(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:null===(r=o.useMapWidgetIds)||void 0===r?void 0:r[0],onActiveViewChange:a}))}function te(e){l.p=e}})(),c})())}}}));