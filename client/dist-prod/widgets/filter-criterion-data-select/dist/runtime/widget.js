System.register(["jimu-core/react","jimu-arcgis","esri/config","esri/layers/FeatureLayer","esri/geometry/Extent","esri/layers/GroupLayer"],(function(e,t){var o={},s={},n={},r={},i={},a={};return{setters:[function(e){o.default=e.default,o.useEffect=e.useEffect,o.useRef=e.useRef,o.useState=e.useState},function(e){s.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.default=e.default},function(e){r.default=e.default},function(e){i.default=e.default},function(e){a.default=e.default}],execute:function(){e((()=>{var e={725:e=>{"use strict";e.exports=n},420:e=>{"use strict";e.exports=i},633:e=>{"use strict";e.exports=r},750:e=>{"use strict";e.exports=a},686:e=>{"use strict";e.exports=s},972:e=>{"use strict";e.exports=o}},t={};function l(o){var s=t[o];if(void 0!==s)return s.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,l),n.exports}l.d=(e,t)=>{for(var o in t)l.o(t,o)&&!l.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var c={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(c),l.d(c,{__set_webpack_public_path__:()=>g,default:()=>f});var e=l(972),t=l(686),o=l(725),s=l(633),n=l(420),r=l(750),i=function(e,t,o,s){return new(o||(o=Promise))((function(n,r){function i(e){try{l(s.next(e))}catch(e){r(e)}}function a(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}l((s=s.apply(e,t||[])).next())}))};o.default.request.interceptors.push({urls:/Pocos_Sem_Simbolos\/FeatureServer\/0/,before:e=>{e.requestOptions.query=Object.assign(Object.assign({},e.requestOptions.query),{f:"json"})}});const a="https://basegis.petrobras.com.br/arcgis/rest/services/EXPLORA/Pocos_Sem_Simbolos/FeatureServer/0",u=600,d=40,p=new n.default({xmin:-74,ymin:-34,xmax:-34,ymax:5,spatialReference:{wkid:4326}});function f(o){var n;const l=(0,e.useRef)(),[c,f]=(0,e.useState)(null),[g,m]=(0,e.useState)([]),y=new Set,h=["https://localhost:3001","https://portalgis.petrobras.com.br","http://localhost:8080"];return(0,e.useEffect)((()=>{const e=e=>{if(!h.includes(e.origin))return void console.warn("Origem n\xe3o permitida:",e.origin);const{type:t,data:o}=e.data||{};"codigosPocos"===t&&Array.isArray(o)&&o.length>0&&m(o)};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)}),[]),(0,e.useEffect)((()=>{c&&window.parent.postMessage({type:"widgetReady"},"*")}),[c]),(0,e.useEffect)((()=>{c&&g.length>0&&function(e,t){i(this,void 0,void 0,(function*(){var o,n,i;try{e.view&&(e.view.extent=p)}catch(e){}const l=e.view.map;let c=l.layers.find((e=>"pocos-group"===e.id));c||(c=new r.default({id:"pocos-group",title:"Po\xe7os",visibilityMode:"inherited",listMode:"show"}),l.add(c));const f=[];c.layers.forEach((e=>{var t;(null===(t=e.id)||void 0===t?void 0:t.startsWith("pocos-lote-"))&&f.push(e)})),f.forEach((e=>c.remove(e)));const g=Array.from(new Set(t.map((e=>String(e).trim())))),m=d*u,h=g.slice(0,m),v=new s.default({url:a});yield v.load();const w=v.fields.find((e=>"POCO_CD_POCO"===e.name)),O="string"===(null==w?void 0:w.type),C=Math.ceil(h.length/u);C>d&&console.warn(`Estimado ${C} lotes (> ${d}). Considerando apenas os primeiros ${d} lotes (${m} c\xf3digos).`);let S=0;const b=h.length;console.log(`\u25b6\ufe0f Iniciando plotagem de po\xe7os: ${b} c\xf3digos \xfanicos em at\xe9 ${Math.min(C,d)} lotes.`);for(let e=0;e<h.length&&e/u<d;e+=u){const t=e/u+1,n=h.slice(e,e+u),r=`POCO_CD_POCO IN (${O?n.map((e=>`'${e}'`)).join(","):n.join(",")})`,i=new s.default({id:`pocos-lote-${String(t).padStart(3,"0")}`,url:a,title:`Po\xe7os (lote ${t})`,definitionExpression:r,outFields:["POCO_CD_POCO"],featureReduction:null,listMode:"hide"});try{yield i.load(),c.add(i);const e=i.createQuery();e.where=r,e.outFields=["POCO_CD_POCO"],e.returnDistinctValues=!0,e.returnGeometry=!1;const s=(yield i.queryFeatures(e)).features.map((e=>String(e.attributes.POCO_CD_POCO).trim()));s.forEach((e=>y.add(e)));const n=y.size;console.log(`\u2705 Lote ${t}: +${s.length} \xfanicos (acumulado ${n}/${b})`);const a=yield i.queryFeatureCount({where:r});console.log(`\u2139\ufe0f  Lote ${t}: ${a} fei\xe7\xf5es (p/ depura\xe7\xe3o)`);try{null===(o=window.parent)||void 0===o||o.postMessage({type:"plotProgress",count:S,expected:b,lot:t},"*")}catch(e){}}catch(e){console.error("Erro ao carregar/contar lote",t,e)}}const x=[...new Set(h.map((e=>String(e).trim())))].filter((e=>!y.has(e)));console.log(`\u{1f3c1} Distintos retornados: ${y.size}/${b}`),console.log(`\u{1f50e} C\xf3digos sem fei\xe7\xe3o (${x.length}):`,x.slice(0,50),x.length>50?"...":"");try{null===(n=window.parent)||void 0===n||n.postMessage({type:"plotDiagnostics",distinctFound:y.size,expected:b,missingCount:x.length,sampleMissing:x.slice(0,50)},"*")}catch(e){}console.log(`\u{1f3c1} Plotagem conclu\xedda. Total efetivamente retornado pelo servi\xe7o: ${S}/${b}.`);try{null===(i=window.parent)||void 0===i||i.postMessage({type:"plotDone",total:S,expected:b},"*")}catch(e){}}))}(c,g)}),[c,g]),e.default.createElement("div",{style:{height:"100%",width:"100%"}},e.default.createElement(t.JimuMapViewComponent,{useMapWidgetId:null===(n=o.useMapWidgetIds)||void 0===n?void 0:n[0],onActiveViewChange:e=>{e&&(l.current=e,f(e))}}))}function g(e){l.p=e}})(),c})())}}}));