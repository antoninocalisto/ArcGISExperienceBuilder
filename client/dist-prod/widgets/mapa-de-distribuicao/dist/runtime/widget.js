System.register(["jimu-core","jimu-arcgis","esri/layers/FeatureLayer","esri/widgets/Legend","esri/renderers/ClassBreaksRenderer","esri/symbols/SimpleMarkerSymbol"],(function(e,t){var o={},a={},s={},i={},r={},n={};return{setters:[function(e){o.Global=e.Global,o.React=e.React,o.css=e.css,o.jsx=e.jsx},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){s.default=e.default},function(e){i.default=e.default},function(e){r.default=e.default},function(e){n.default=e.default}],execute:function(){e((()=>{var e={633:e=>{"use strict";e.exports=s},841:e=>{"use strict";e.exports=r},417:e=>{"use strict";e.exports=n},828:e=>{"use strict";e.exports=i},686:e=>{"use strict";e.exports=a},244:e=>{"use strict";e.exports=o}},t={};function l(o){var a=t[o];if(void 0!==a)return a.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,l),s.exports}l.d=(e,t)=>{for(var o in t)l.o(t,o)&&!l.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var c={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(c),l.d(c,{__set_webpack_public_path__:()=>R,default:()=>S});var e=l(244),t=l(686),o=l(633),a=l(828),s=l(841),i=l(417),r=function(e,t,o,a){return new(o||(o=Promise))((function(s,i){function r(e){try{l(a.next(e))}catch(e){i(e)}}function n(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,n)}l((a=a.apply(e,t||[])).next())}))};const n={lateral:"rgba(88, 19, 252, 0.7)",testemunho:"rgba(255, 0, 255, 0.7)",calha:"rgba(245, 201, 38, 0.7)",plug:"rgba(125, 253, 148, 0.7)","whole core":"rgba(255, 43, 24, 0.7)"};var u=function(e,t,o,a){return new(o||(o=Promise))((function(s,i){function r(e){try{l(a.next(e))}catch(e){i(e)}}function n(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,n)}l((a=a.apply(e,t||[])).next())}))};const d=e=>Math.log10?Math.log10(e):Math.log(e)/Math.LN10,p={lateral:"totalAmostrasLaterais",testemunho:"totalTestemunhos",calha:"totalCalhas",plug:"totalPlugs","whole core":"totalWholeCore"},m=Object.keys(p),f=!1;function g(e){return new Promise(((t,o)=>{const a=Math.random().toString(36).slice(2);let s="*";try{document.referrer&&(s=new URL(document.referrer).origin)}catch(e){}const i=e=>{const s=e.data||{};var r;s.reqId===a&&("fetchDistribuicaoAmostras:ok"===s.type?(window.removeEventListener("message",i),t((r=s.payload,(Array.isArray(r)?r:[]).map((e=>{var t,o,a,s,i,r,n,l,c,u,d,p,m,f;return{codigoPoco:Number(null!==(s=null!==(a=null!==(o=null!==(t=e.codigoPoco)&&void 0!==t?t:e.POCO_CD_POCO)&&void 0!==o?o:e.poco)&&void 0!==a?a:e.codigo)&&void 0!==s?s:0),totalAmostrasLaterais:Number(null!==(r=null!==(i=e.totalAmostrasLaterais)&&void 0!==i?i:e.laterais)&&void 0!==r?r:0),totalCalhas:Number(null!==(l=null!==(n=e.totalCalhas)&&void 0!==n?n:e.calhas)&&void 0!==l?l:0),totalPlugs:Number(null!==(u=null!==(c=e.totalPlugs)&&void 0!==c?c:e.plugs)&&void 0!==u?u:0),totalTestemunhos:Number(null!==(p=null!==(d=e.totalTestemunhos)&&void 0!==d?d:e.testemunhos)&&void 0!==p?p:0),totalWholeCore:Number(null!==(f=null!==(m=e.totalWholeCore)&&void 0!==m?m:e.wholeCore)&&void 0!==f?f:0)}})).filter((e=>!!e.codigoPoco))))):"fetchDistribuicaoAmostras:err"===s.type&&(window.removeEventListener("message",i),o(new Error(s.message||"Erro no fetch via parent"))))};window.addEventListener("message",i),window.parent.postMessage({type:"fetchDistribuicaoAmostras",url:"/module-explora/explora",body:e,reqId:a},s)}))}function h(){return u(this,arguments,void 0,(function*(e=!1){const t=function(e){const t=new URLSearchParams;return t.set("hdSys","novaintcons"),t.set("hdUC","Mapa"),t.set("hdAcao","CarregarMapaDistribuicaoAmostrasContador"),t.set("hdSessionFilter","true"),t.set("faixaInteresse",String(!!e)),t.toString()}(e);return g(t)}))}const x=e.css`
  div[role='dialog'][aria-label='mapa-de-distribuicao'] {
    position: absolute !important;
    inset: 50px 12px auto auto !important; /* top:12, right:12 */
    transform: none !important;
    z-index: 9999 !important;
    width: 360px !important;
    height: 550px !important;
    max-height: calc(100% - 24px) !important;
    overflow: auto !important;
  }
`,b=e.css`
  width: ${40}px;
  height: ${40}px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 8px;
`,v=e.css`
  position: relative; width: 100%; height: 100%;
  background: #fff; border: 1px solid #ddd; border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,.1); padding: 16px; overflow: hidden;
`,y=e.css`font-weight:600; margin-bottom:4px; display:block;`,w=e.css`width:100%; padding:6px 8px; margin-bottom:12px;
  border:1px solid #ccc; border-radius:4px;`,j=e.css`overflow-y:auto; margin-bottom:12px;
  padding:8px; background:#fafafa; border:1px solid #eee; border-radius:4px;`,C=e.css`display:flex; align-items:center; margin-bottom:6px; cursor:pointer;`,M=e.css`
  max-height: 300px;
  overflow-y: auto;
  margin-top: 8px;
  padding: 8px;
  padding-bottom: 36px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 4px;
  position: relative;
`,P=e.css`display:flex; align-items:center; margin-bottom:6px;`,k=e.css`font-size:0.9rem;`,_=e.css`
  position: sticky;
  bottom: 0;
  background: #fff;
  border-top: 1px solid #eee;
  padding: 4px 0;
  display: flex;
  align-items: center;
`,O=e.css`
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  font-size: 0.9rem;
`;function S(l){var c;const[g,S]=e.React.useState(),[R,E]=e.React.useState(""),[L,A]=e.React.useState([]),[$,z]=e.React.useState(!1),[I,D]=e.React.useState(null),[F,N]=e.React.useState(!1),[V,T]=e.React.useState("");e.React.useEffect((()=>{console.log("mapa-de-distribuicao novo 25-08: categoria mudou ",R);let e=!1;return function(){u(this,void 0,void 0,(function*(){if("sample"===R){N(!0),T("");try{const t=yield h(f);e||(D(t),A([]))}catch(t){e||(T((null==t?void 0:t.message)||"Falha ao buscar dados"),D([]))}finally{e||N(!1)}}}))}(),()=>{e=!0}}),[R]);const B=e.React.useCallback((e=>(null!=I?I:[]).map((t=>{var o;return{codigoPoco:t.codigoPoco,total:null!==(o=t[p[e]])&&void 0!==o?o:0}}))),[I]);e.React.useEffect((()=>{if(!g)return;const{view:e}=g;m.forEach((t=>{const o=e.map.findLayerById("amostras_"+t);o&&e.map.remove(o)})),I&&0!==I.length&&L.forEach((e=>{const t=B(e),l=n[e]||"rgba(0,0,0,0.5)";!function(e){r(this,arguments,void 0,(function*({jimuMapView:e,dados:t,colorFill:r,idCamada:n,idLegenda:l,titleLegenda:c}){const u=e.view,d=u.map,p=`POCO_CD_POCO IN (${t.map((e=>e.codigoPoco)).join(",")})`,m=new o.default({url:"https://basegis.petrobras.com.br/arcgis/rest/services/EXPLORA/Feature_Pocos/MapServer/0",definitionExpression:p,title:"Po\xe7os",outFields:["*"],visible:!1});yield m.load();const f=(yield m.queryFeatures({where:p,outFields:["*"],returnGeometry:!0})).features.map((e=>{const o=t.find((t=>t.codigoPoco===e.attributes.POCO_CD_POCO));return e.attributes.POCO_MD_MERID_CENT=o?o.total:0,e})),g=t.map((e=>e.total));let h=Math.min(...g),x=Math.max(...g);const b=[],v={color:"black",width:"1px"};if(h===x&&0===h)b.push({minValue:0,maxValue:0,label:"N\xe3o h\xe1 dados suficientes",symbol:new i.default({color:"rgba(255,255,255,0)",size:0,style:"circle",outline:v})});else{const e=g.filter((e=>0===e)).length,t=g.filter((e=>e>0));e>0&&b.push({minValue:0,maxValue:0,label:`| 0 | (${e} po\xe7o${e>1?"s":""})`,symbol:new i.default({color:"rgba(200,200,200,0.3)",size:6,style:"circle",outline:v})}),h=1;const o=t.length,a=Math.max(2,Math.round(1+3.3*Math.log10(o))),s=Math.ceil((x-h+1)/a),n=40;for(let e=0;e<a;e++){const o=h+e*s,l=h+(e+1)*s-1;if(o>x)break;const c=t.filter((e=>e>=o&&e<=l)).length,u=`${o} |---| ${l} (${c} po\xe7o${c>1?"s":""})`,d=6+e*(n/a);b.push({minValue:o,maxValue:l,label:u,symbol:new i.default({color:r,size:d,style:"circle",outline:v})})}}const y=new s.default({field:"POCO_MD_MERID_CENT",classBreakInfos:b}),w=new o.default({id:n,source:f,fields:m.fields,objectIdField:"OBJECTID",geometryType:"point",spatialReference:{wkid:102100},renderer:y,title:c,listMode:"hide"}),j=d.findLayerById(n);j&&d.remove(j),d.add(w),new a.default({view:u,layerInfos:[{layer:w,title:c}]})}))}({jimuMapView:g,dados:t,colorFill:l,idCamada:"amostras_"+e,idLegenda:"lgd_amostras_"+e,titleLegenda:e.charAt(0).toUpperCase()+e.slice(1)})}))}),[g,L,B,I]);const U=L.map((e=>{let t=function(e,t){const o=e.map((e=>e.total));let a=Math.min(...o),s=Math.max(...o);const i=[];if(0===a&&0===s)i.push({label:"N\xe3o h\xe1 dados suficientes",size:0,cor:t,count:0});else{const e=o.filter((e=>0===e)).length,r=o.filter((e=>e>0));e>0&&i.push({label:`| 0 | (${e} po\xe7o${e>1?"s":""})`,size:6,cor:"rgba(200,200,200,0.3)",count:e}),a=1;const n=r.length,l=Math.max(2,Math.round(1+3.3*d(n))),c=Math.ceil((s-a+1)/l),u=40;for(let e=0;e<l;e++){const o=a+e*c,n=a+(e+1)*c-1;if(o>s)break;const d=r.filter((e=>e>=o&&e<=n)).length,p=`${o} |---| ${n} (${d} po\xe7o${d>1?"s":""})`,m=6+e*(u/l);i.push({label:p,size:m,cor:t,count:d})}}return i}(B(e),n[e]).reverse();return $||(t=t.filter((e=>e.count>0||e.label.startsWith("| 0 |")))),{tipo:e,rows:t}})),W=Array.isArray(I)&&I.length>0;return(0,e.jsx)("div",{css:v},(0,e.jsx)(e.Global,{styles:x}),(0,e.jsx)("label",{css:y},"Selecione a distribui\xe7\xe3o"),(0,e.jsx)("select",{css:w,value:R,onChange:e=>{E(e.target.value)}},(0,e.jsx)("option",{value:""},"Selecione o tipo"),(0,e.jsx)("option",{value:"sample"},"Distribui\xe7\xe3o de amostra")),"sample"===R&&(0,e.jsx)(e.React.Fragment,null,F&&(0,e.jsx)("div",{style:{marginBottom:8}},"Carregando dados da sess\xe3o\u2026"),!!V&&(0,e.jsx)("div",{style:{color:"#b00",marginBottom:8}},"Erro: ",V),W&&(0,e.jsx)("div",{css:j},m.map((t=>(0,e.jsx)("div",{key:t,css:C,onClick:()=>{return e=t,A((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]));var e}},(0,e.jsx)("input",{type:"checkbox",checked:L.includes(t),readOnly:!0,style:{marginRight:6}}),(0,e.jsx)("span",null,t.charAt(0).toUpperCase()+t.slice(1))))))),U.length>0&&(0,e.jsx)("div",{css:M},U.map((t=>(0,e.jsx)(e.React.Fragment,{key:t.tipo},(0,e.jsx)("div",{css:e.css`font-weight:600; margin:4px 0;`},t.tipo.charAt(0).toUpperCase()+t.tipo.slice(1)),t.rows.map(((o,a)=>(0,e.jsx)("div",{key:`${t.tipo}-${a}`,css:P},(0,e.jsx)("div",{css:b},(0,e.jsx)("svg",{width:o.size,height:o.size},(0,e.jsx)("circle",{cx:o.size/2,cy:o.size/2,r:o.size/2,fill:o.cor}))),(0,e.jsx)("span",{css:k},o.label))))))),(0,e.jsx)("div",{css:_},(0,e.jsx)("label",{css:O},(0,e.jsx)("input",{type:"checkbox",checked:$,onChange:e=>z(e.target.checked)}),"Exibir classes vazias"))),(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:null===(c=l.useMapWidgetIds)||void 0===c?void 0:c[0],onActiveViewChange:S}))}function R(e){l.p=e}})(),c})())}}}));